"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("immer");function t(){return(t=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r}).apply(this,arguments)}var e=function(r,t){return new Error("Cant access property "+String(t)+" of "+String(r))};function n(r){return r instanceof Map?3:r instanceof Set?4:Array.isArray(r)?2:r instanceof Object?1:0}function a(r,t){var a=n(r);if(0===a)throw e(r,t);return 3===a?r.get(t):4===a?r.has(t)?t:void 0:r[t]}function o(r,t){return t.reduce((function(r,t){return a(r,t)}),r)}var i=function(r,e){return e.filter((function(t){return r.every((function(r,e){return r===t.path[e]}))})).map((function(e){return t({},e,{path:e.path.slice(r.length)})}))},u=function(r,e){return e.map((function(e){var n=t({},e,{path:r.concat(e.path)});return e.from&&(n.from=r.concat(e.from)),n}))};r.enablePatches();var p=function(e,n){var a=[],o=0,i=new Map,u=new Map,p=function(r){if(i.has(r))return i.get(r);var t=o++;return i.set(r,t),u.set(t,r),t},c=e.map(p),s=new Set(c),f=[];if(1===n.length&&0===n[0].path.length){var h=n[0].value;if(!Array.isArray(h))return n;f=h.map(p)}else{if(e.some((function(r){return"object"!=typeof r})))return n;var v=n.map((function(r){var e=r.op,n=r.path;return"remove"===e||"replace"===e&&1===n.length&&"length"===n[0]?r:t({},r,{value:p(r.value)})}));f=r.applyPatches(c,v)}var l=f.filter((function(r){return s.has(r)})),g=c.slice();return l.forEach((function(r,t){if(r!==g[t]){var e=g.indexOf(r);a.push({op:"move",from:[e],path:[t]}),g.splice(e,1),g.splice(t,0,r)}})),l.length<c.length&&a.push({op:"replace",path:["length"],value:l.length}),f.forEach((function(r,t){if(!s.has(r)){var e=u.get(r);a.push({op:"add",path:[t],value:e})}})),a};exports.ARRAY=2,exports.BASIC=0,exports.MAP=3,exports.OBJECT=1,exports.SET=4,exports.applyPatches=function(t,e){return e.forEach((function(e){if("move"===e.op){var n=e.from;t=r.applyPatches(t,[{op:"remove",path:n},{op:"add",path:e.path,value:o(t,n)}])}else t=r.applyPatches(t,[e])})),t},exports.clone=function(r){var e=n(r);return 1===e?t({},r):2===e?r.slice():3===e?new Map(r):4===e?new Set(r):r},exports.create=function(r){return 1===r?{}:2===r?[]:3===r?new Map:4===r?new Set:void 0},exports.entries=function(r){var t=n(r);if(1===t)return Object.entries(r);if(2===t||3===t||4===t)return Array.from(r.entries());throw e(r,"any")},exports.get=a,exports.getIn=o,exports.getType=n,exports.has=function(r,t){var a=n(r);if(1===a)return t in r;if(2===a)return t<r.length&&t>-1;if(3===a||4===a)return r.has(t);throw e(r,t)},exports.optimise=function(e,n){var a,c,s=[],f=[],h=function(){if(0!==f.length){if(c){var r=o(e,c),t=i(c,f),n=p(r,t),a=u(c,n);s=s.concat(a)}else s=s.concat(f);f=[]}};return n.forEach((function(n){var i=n.path.slice(0,-1),u=function(r,t){var e=JSON.stringify(t);if(a&&a[1]===e)return a[0];var n=Array.isArray(o(r,t));return a=[n,e],n}(e,i)?i:void 0;JSON.stringify(u)!==JSON.stringify(c)&&(h(),c=u),n.value===r.nothing&&(n=t({},n,{value:void 0})),f.push(n)})),h(),s},exports.optimiseArray=p,exports.set=function(r,t,a){var o=n(r);if(0===o)throw e(r,t);return 3===o?r.set(t,a):4===o?(r.delete(t),void r.add(a)):void(r[t]=a)},exports.zoomInPatches=i,exports.zoomOutPatches=u;
//# sourceMappingURL=dendriform-immer-patch-optimiser.cjs.production.min.js.map
